{% extends 'default.html' %}
{% load static %}

{% block tour_detail %}
<link rel="stylesheet" href="{% static 'miniapp/css/profile.css' %}">

<div class="profile-container">
    <!-- –§–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="profile-avatar">
        <img id="tg-avatar" src="{% static 'miniapp/img/avatar-placeholder.png' %}" alt="–ê–≤–∞—Ç–∞—Ä">
    </div>

    <!-- –ò–º—è -->
    <h2 id="tg-name">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

    <!-- Username -->
    <p id="tg-username">@username</p>

    <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
    {% if profile.phone_number %}
        <p id="tg-phone">–¢–µ–ª–µ—Ñ–æ–Ω: {{ profile.phone_number }}</p>
    {% else %}
        <p id="tg-phone">–¢–µ–ª–µ—Ñ–æ–Ω: –Ω–µ —É–∫–∞–∑–∞–Ω</p>
        <button id="add-phone-btn" class="btn">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä</button>
    {% endif %}
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    // –ë–µ—Ä—ë–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram WebApp
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user;

    if (user) {
        // –ò–º—è
        document.getElementById("tg-name").innerText =
            (user.first_name || "") + " " + (user.last_name || "");

        // username
        if (user.username) {
            document.getElementById("tg-username").innerText = "@" + user.username;
        }

        // –∞–≤–∞—Ç–∞—Ä–∫–∞
        if (user.photo_url) {
            document.getElementById("tg-avatar").src = user.photo_url;
        }
    }

    // –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    const addPhoneBtn = document.getElementById("add-phone-btn");
    if (addPhoneBtn) {
        addPhoneBtn.addEventListener("click", () => {
            tg.MainButton.text = "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º";
            tg.MainButton.show();

            tg.MainButton.onClick(() => {
                // üî• –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –≤ –±–æ—Ç–∞
                tg.sendData(JSON.stringify({ action: "request_phone" }));
            });
        });
    }
</script>
{% endblock %}
